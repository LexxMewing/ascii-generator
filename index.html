<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Image → ASCII Generator — Bos Lexx</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#16a34a;
    --muted:#94a3b8;
    --glass: rgba(255,255,255,0.03);
    --btn-padding:10px 14px;
    --radius:12px;
  }
  html,body{
    height:100%;
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#081024 0%, #061426 100%);
    color: #e6eef8;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  .wrap{
    max-width:980px;
    margin:18px auto;
    padding:18px;
  }
  header{
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:14px;
  }
  header h1{
    font-size:18px;
    margin:0;
    letter-spacing:0.4px;
  }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius);
    padding:12px;
    box-shadow: 0 6px 24px rgba(2,6,23,0.6);
  }
  .controls{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    align-items:center;
  }
  .file-row{
    display:flex;
    gap:10px;
    align-items:center;
    flex:1 1 320px;
  }
  .file-row input[type=file]{
    display:none;
  }
  .btn{
    background:var(--glass);
    border:1px solid rgba(255,255,255,0.04);
    color:var(--accent);
    padding:var(--btn-padding);
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
  }
  .btn.primary{
    background:linear-gradient(90deg,#0ea5a5,#7c3aed);
    color:white;
    border:none;
  }
  label.select-like{
    background:rgba(255,255,255,0.03);
    padding:8px 12px;
    border-radius:8px;
    display:inline-flex;
    gap:8px;
    align-items:center;
  }
  .option{
    display:flex;
    gap:8px;
    align-items:center;
  }
  input[type=range]{
    accent-color: var(--accent);
    width:140px;
  }
  .main{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
    margin-top:12px;
  }
  @media (max-width:820px){
    .main{ grid-template-columns: 1fr; }
  }
  .preview{
    min-height:260px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
    border-radius:10px;
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }
  .preview canvas{
    width:100%;
    height:auto;
    border-radius:6px;
    background:#081018;
  }
  .ascii-output{
    overflow:auto;
    background:#031024;
    border-radius:10px;
    padding:12px;
    font-family: "Courier New", Courier, monospace;
    font-size:10px;
    line-height:10px;
    color:#e6eef8;
    white-space:pre;
    min-height:260px;
  }
  .ascii-colored{
    white-space:pre;
    line-height:10px;
    font-family: monospace;
    font-size:10px;
  }
  .actions{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:8px;
  }
  .muted{ color:var(--muted); font-size:13px;}
  footer{ margin-top:12px; color:var(--muted); font-size:13px; }
  .small{
    font-size:12px;
    color:var(--muted);
  }
  .controls .group{ display:flex; gap:8px; align-items:center; }
  .download-link{ color:inherit; text-decoration:none; }
  .note{ font-size:12px; color:var(--muted); margin-top:6px; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="https://files.catbox.moe/sdcnbs.png" alt="" style="width:38px;height:38px;border-radius:8px;background:#062834;display:block" />
      <div>
        <h1>Image → ASCII Generator</h1>
        <div class="small">Upload gambar lalu pilih <strong>Grayscale</strong> atau <strong>Colored</strong>. Buatlah ukuran kecil kalau di HP supaya rapi.</div>
      </div>
    </header>

    <div class="card">
      <div class="controls">
        <div class="file-row">
          <label class="btn" id="uploadBtn">Pilih Gambar
            <input type="file" id="fileInput" accept="image/*">
          </label>
          <div class="muted" id="fileName">Belum ada file</div>
        </div>

        <div class="group">
          <label class="select-like">Width: <span id="widthVal">80</span>
            <input type="range" id="widthRange" min="30" max="200" value="80">
          </label>
        </div>

        <div class="group">
          <label class="select-like"><input type="checkbox" id="colorCheck"> Berwarna</label>
        </div>

        <div class="group">
          <label class="select-like">Karakter:
            <select id="charset">
              <option value="@%#*+=-:. ">Gelap→Terang (Default)</option>
              <option value="$@B%8&WM#*oahkbdpqwmZ0OQLCJUYXzcvunxrjft/\\|()1{}[]?-_+~<>i!lI;:,\"^`'. ">Densest</option>
              <option value=" .:-=+*#%@">Simple</option>
            </select>
          </label>
        </div>

        <div style="margin-left:auto" class="group">
          <button class="btn primary" id="genBtn">Generate ASCII</button>
        </div>
      </div>

      <div class="main">
        <div class="preview">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div class="small">Preview (Canvas)</div>
            <div class="small muted">Untuk kontrol detail gunakan Width</div>
          </div>
          <canvas id="previewCanvas"></canvas>
          <div class="note">Preview hanya untuk membantu; hasil akhir di sebelah kanan.</div>
        </div>

        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <div class="small">Hasil ASCII</div>
            <div class="small muted">Gunakan tombol untuk salin / download</div>
          </div>

          <div id="asciiContainer" class="ascii-output" tabindex="0">Hasil akan muncul di sini setelah klik <strong>Generate ASCII</strong>.</div>

          <div class="actions">
            <button class="btn" id="copyBtn">Salin</button>
            <button class="btn" id="downloadBtn">Download .txt</button>
            <button class="btn" id="resetBtn">Reset</button>
          </div>
        </div>
      </div>

      <footer>
        Tips: pilih Width rendah (30–80) untuk tampilan di HP. Centang <em>Berwarna</em> untuk hasil yang lebih mirip warna aslinya.
      </footer>
    </div>
  </div>

<script>
(function(){
  const fileInput = document.getElementById('fileInput');
  const fileName = document.getElementById('fileName');
  const previewCanvas = document.getElementById('previewCanvas');
  const ctx = previewCanvas.getContext('2d');
  const genBtn = document.getElementById('genBtn');
  const asciiContainer = document.getElementById('asciiContainer');
  const widthRange = document.getElementById('widthRange');
  const widthVal = document.getElementById('widthVal');
  const colorCheck = document.getElementById('colorCheck');
  const charsetSelect = document.getElementById('charset');
  const copyBtn = document.getElementById('copyBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const resetBtn = document.getElementById('resetBtn');

  let img = new Image();
  let lastDataURL = null;

  widthRange.addEventListener('input', () => {
    widthVal.textContent = widthRange.value;
  });

  // load file
  fileInput.addEventListener('change', (e)=>{
    if (!e.target.files || !e.target.files[0]) return;
    const file = e.target.files[0];
    fileName.textContent = file.name;
    const reader = new FileReader();
    reader.onload = function(ev){
      img = new Image();
      img.onload = function(){
        // draw on canvas scaled to file's aspect ratio
        previewCanvas.width = img.width;
        previewCanvas.height = img.height;
        ctx.clearRect(0,0,previewCanvas.width, previewCanvas.height);
        ctx.drawImage(img,0,0);
        lastDataURL = ev.target.result;
      };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  });

  function mapPixelToChar(bright, chars){
    // bright 0..255 -> index 0..len-1
    const idx = Math.floor((bright/255) * (chars.length - 1));
    return chars[idx];
  }

  function generateASCII(opts){
    if (!img || !lastDataURL) {
      alert('Pilih gambar dulu, Bos Lexx!');
      return;
    }
    const desiredWidth = parseInt(opts.width,10);
    const charset = opts.charset;
    const color = opts.color;

    // compute sample cell size
    const originalW = img.width;
    const originalH = img.height;
    const aspectRatio = originalH / originalW;

    // Character height vs width correction factor: characters are taller; tweak for better proportions
    const correction = 0.55;

    const newW = desiredWidth;
    const newH = Math.max(1, Math.floor(aspectRatio * newW * correction));

    // draw resized image to offscreen canvas
    const off = document.createElement('canvas');
    off.width = newW;
    off.height = newH;
    const offCtx = off.getContext('2d');

    // ensure high quality scaling
    offCtx.imageSmoothingEnabled = true;
    offCtx.drawImage(img, 0, 0, newW, newH);

    const imgData = offCtx.getImageData(0,0,newW,newH).data;
    let ascii = '';
    if (color) {
      // build HTML with colored spans
      ascii += '<div class="ascii-colored">';
      for (let y=0;y<newH;y++){
        for (let x=0;x<newW;x++){
          const idx = (y*newW + x)*4;
          const r = imgData[idx], g = imgData[idx+1], b = imgData[idx+2];
          const bright = 0.299*r + 0.587*g + 0.114*b;
          const ch = mapPixelToChar(bright, charset);
          // use non-breaking-space for space char to preserve width
          const displayChar = ch === ' ' ? '&nbsp;' : escapeHtml(ch);
          ascii += `<span style="color: rgb(${r},${g},${b});">${displayChar}</span>`;
        }
        ascii += '<br>';
      }
      ascii += '</div>';
    } else {
      // plain text grayscale
      for (let y=0;y<newH;y++){
        for (let x=0;x<newW;x++){
          const idx = (y*newW + x)*4;
          const r = imgData[idx], g = imgData[idx+1], b = imgData[idx+2];
          const bright = 0.299*r + 0.587*g + 0.114*b;
          const ch = mapPixelToChar(bright, charset);
          ascii += ch;
        }
        if (y < newH - 1) ascii += '\n';
      }
    }

    return { ascii, plainText: color ? htmlToPlainText(ascii) : ascii, html: ascii };
  }

  // helper to escape special HTML chars
  function escapeHtml(ch){
    return ch.replace(/[&<>"']/g, function(m){
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
    });
  }

  // Convert colored HTML ascii to a plain-text approximation (strip tags and convert &nbsp;).
  function htmlToPlainText(html){
    const tmp = html.replace(/<[^>]+>/g, ''); // remove tags
    return tmp.replace(/\u00A0/g, ' '); // NBSP
  }

  genBtn.addEventListener('click', ()=>{
    const opts = {
      width: widthRange.value,
      color: colorCheck.checked,
      charset: document.getElementById('charset').value
    };
    // show preview scaled down to canvas for user
    // update preview canvas size for better mobile fit
    const previewMaxW = Math.min(window.innerWidth - 80, 640);
    // draw a scaled preview
    const scale = Math.min(previewMaxW / img.width, 1);
    previewCanvas.width = Math.floor(img.width * scale);
    previewCanvas.height = Math.floor(img.height * scale);
    ctx.clearRect(0,0,previewCanvas.width, previewCanvas.height);
    ctx.drawImage(img, 0, 0, previewCanvas.width, previewCanvas.height);

    const result = generateASCII(opts);
    if (opts.color){
      asciiContainer.innerHTML = result.html;
      asciiContainer.classList.remove('ascii-output');
      asciiContainer.classList.add('ascii-colored');
    } else {
      asciiContainer.textContent = result.plainText;
      asciiContainer.classList.remove('ascii-colored');
      asciiContainer.classList.add('ascii-output');
    }
    // store for download/copy
    asciiContainer._lastText = result.plainText;
    asciiContainer._lastHtml = result.html;
  });

  copyBtn.addEventListener('click', () => {
    const text = asciiContainer._lastText || asciiContainer.innerText || asciiContainer.textContent;
    if (!text){
      alert('Belum ada hasil untuk disalin.');
      return;
    }
    navigator.clipboard.writeText(text).then(()=> {
      copyBtn.textContent = 'Tersalin ✓';
      setTimeout(()=> copyBtn.textContent = 'Salin', 1500);
    }).catch(()=> alert('Gagal menyalin. Coba manual.'));
  });

  downloadBtn.addEventListener('click', () => {
    const text = asciiContainer._lastText || asciiContainer.innerText || asciiContainer.textContent;
    if (!text){
      alert('Belum ada hasil untuk didownload.');
      return;
    }
    const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    const now = new Date();
    const stamp = now.toISOString().replace(/[:.]/g,'-');
    a.download = `ascii-${stamp}.txt`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  resetBtn.addEventListener('click', ()=>{
    fileInput.value = '';
    fileName.textContent = 'Belum ada file';
    asciiContainer.innerHTML = 'Hasil akan muncul di sini setelah klik <strong>Generate ASCII</strong>.';
    asciiContainer._lastText = '';
    asciiContainer._lastHtml = '';
    ctx.clearRect(0,0,previewCanvas.width, previewCanvas.height);
  });

  // Allow clicking the custom upload button area to open file dialog
  document.getElementById('uploadBtn').addEventListener('click', ()=>{
    fileInput.click();
  });

})();
</script>
</body>
</html>